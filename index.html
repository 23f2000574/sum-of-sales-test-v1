<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Load Bootstrap 5 from jsdelivr -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Title placeholder, set by script later -->
    <title>Loading Sales Data...</title> 
</head>
<body class="bg-light">
    <div class="container mt-5">
        <header class="mb-4 text-center">
            <h1 class="display-4">Enterprise Sales Summary</h1>
            <p class="lead">Real-time total revenue calculation from attached data.</p>
        </header>
        
        <div class="card shadow-lg mx-auto" style="max-width: 400px;">
            <div class="card-header bg-success text-white">
                <i class="bi bi-cash me-2"></i> TOTAL SALES REVENUE
            </div>
            <div class="card-body text-center">
                <div class="h1 fw-bold text-success">
                    $ <span id="total-sales">... Loading ...</span>
                </div>
                <p class="card-text text-muted mt-3">Refreshed from data.csv</p>
            </div>
        </div>
    </div>

    <script>
        /**
         * Fetches 'data.csv', parses the 'sales' column, calculates the total,
         * and updates the document title and the #total-sales element.
         */
        async function loadSalesSummary() {
            // 3. Set the document title
            document.title = 'Sales Summary student-test-seed';

            const totalSalesElement = document.getElementById('total-sales');
            
            try {
                // 1. Fetch data.csv
                const response = await fetch('data.csv');
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const csvText = await response.text();

                const lines = csvText.trim().split('\n');
                if (lines.length <= 1) {
                    totalSalesElement.textContent = '0.00';
                    return;
                }

                // Parse headers and find the 'sales' column index (case-insensitive check for robustness)
                const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
                const salesIndex = headers.indexOf('sales');

                if (salesIndex === -1) {
                    throw new Error("CSV structure invalid: 'sales' column not found.");
                }

                let totalSales = 0;

                // Iterate over data rows (starting from index 1)
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    // Simple CSV parsing (assuming standard comma separation)
                    const values = line.split(',');
                    
                    if (values.length > salesIndex) {
                        // Attempt to parse the sales value
                        const salesValue = parseFloat(values[salesIndex].trim());
                        
                        if (!isNaN(salesValue)) {
                            totalSales += salesValue;
                        }
                    }
                }

                // 4. Display the total inside #total-sales, formatted to 2 decimal places
                totalSalesElement.textContent = totalSales.toFixed(2);

            } catch (error) {
                console.error("Data processing failed:", error);
                totalSalesElement.textContent = 'N/A';
                totalSalesElement.classList.remove('text-success');
                totalSalesElement.classList.add('text-danger');
            }
        }

        // Execute the function when the DOM is fully loaded
        window.addEventListener('DOMContentLoaded', loadSalesSummary);
    </script>
</body>
</html>